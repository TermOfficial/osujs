this.osujs=this.osujs||{};
osujs.assets=function(){var a=new createjs.LoadQueue(!0);a.installPlugin(createjs.Sound);a.get=a.getResult;a.beginLoad=function(){a.addEventListener("complete",function(){a.sliderb=new createjs.SpriteSheet({images:[a.get("img_sliderb0"),a.get("img_sliderb1"),a.get("img_sliderb2"),a.get("img_sliderb3"),a.get("img_sliderb4"),a.get("img_sliderb5"),a.get("img_sliderb6"),a.get("img_sliderb7"),a.get("img_sliderb8"),a.get("img_sliderb9")],frames:{width:a.get("img_sliderb0").width,height:a.get("img_sliderb0").height},
animations:{slide:[0,9],reverseSlide:{frames:[9,8,7,6,5,4,3,2,1,0]}}})});a.loadManifest([{id:"aud_Normal-hitclap",src:"assets/skin/normal-hitclap.mp3"},{id:"aud_Normal-hitfinish",src:"assets/skin/normal-hitfinish.mp3"},{id:"aud_Normal-hitnormal",src:"assets/skin/normal-hitnormal.mp3"},{id:"aud_Normal-hitwhistle",src:"assets/skin/normal-hitwhistle.mp3"},{id:"aud_Soft-hitclap",src:"assets/skin/soft-hitclap.mp3"},{id:"aud_Soft-hitfinish",src:"assets/skin/soft-hitfinish.mp3"},{id:"aud_Soft-hitnormal",
src:"assets/skin/soft-hitnormal.mp3"},{id:"aud_Soft-hitwhistle",src:"assets/skin/soft-hitwhistle.mp3"},{id:"img_approachcircle",src:"assets/skin/approachcircle.png"},{id:"img_cursor",src:"assets/skin/cursor.png"},{id:"img_cursormiddle",src:"assets/skin/cursormiddle.png"},{id:"img_default0",src:"assets/skin/default-0.png"},{id:"img_default1",src:"assets/skin/default-1.png"},{id:"img_default2",src:"assets/skin/default-2.png"},{id:"img_default3",src:"assets/skin/default-3.png"},{id:"img_default4",src:"assets/skin/default-4.png"},
{id:"img_default5",src:"assets/skin/default-5.png"},{id:"img_default6",src:"assets/skin/default-6.png"},{id:"img_default7",src:"assets/skin/default-7.png"},{id:"img_default8",src:"assets/skin/default-8.png"},{id:"img_default9",src:"assets/skin/default-9.png"},{id:"img_hit0",src:"assets/skin/hit0.png"},{id:"img_hit100",src:"assets/skin/hit100.png"},{id:"img_hit100k",src:"assets/skin/hit100k.png"},{id:"img_hit300",src:"assets/skin/hit300.png"},{id:"img_hit300g",src:"assets/skin/hit300g.png"},{id:"img_hit300k",
src:"assets/skin/hit300k.png"},{id:"img_hit50",src:"assets/skin/hit50.png"},{id:"img_hitcircle",src:"assets/skin/hitcircle.png"},{id:"img_hitcircleoverlay",src:"assets/skin/hitcircleoverlay.png"},{id:"img_logo",src:"assets/skin/logo.png"},{id:"img_score0",src:"assets/skin/score-0.png"},{id:"img_score1",src:"assets/skin/score-1.png"},{id:"img_score2",src:"assets/skin/score-2.png"},{id:"img_score3",src:"assets/skin/score-3.png"},{id:"img_score4",src:"assets/skin/score-4.png"},{id:"img_score5",src:"assets/skin/score-5.png"},
{id:"img_score6",src:"assets/skin/score-6.png"},{id:"img_score7",src:"assets/skin/score-7.png"},{id:"img_score8",src:"assets/skin/score-8.png"},{id:"img_score9",src:"assets/skin/score-9.png"},{id:"img_scorex",src:"assets/skin/score-x.png"},{id:"img_sliderb0",src:"assets/skin/sliderb0.png"},{id:"img_sliderb1",src:"assets/skin/sliderb1.png"},{id:"img_sliderb2",src:"assets/skin/sliderb2.png"},{id:"img_sliderb3",src:"assets/skin/sliderb3.png"},{id:"img_sliderb4",src:"assets/skin/sliderb4.png"},{id:"img_sliderb5",
src:"assets/skin/sliderb5.png"},{id:"img_sliderb6",src:"assets/skin/sliderb6.png"},{id:"img_sliderb7",src:"assets/skin/sliderb7.png"},{id:"img_sliderb8",src:"assets/skin/sliderb8.png"},{id:"img_sliderb9",src:"assets/skin/sliderb9.png"},{id:"img_sliderfollowcircle",src:"assets/skin/sliderfollowcircle.png"},{id:"img_sliderscorepoint",src:"assets/skin/sliderscorepoint.png"},{id:"img_spinnerbottom",src:"assets/skin/spinner-bottom.png"},{id:"img_spinnerclear",src:"assets/skin/spinner-clear.png"},{id:"img_spinnermiddle",
src:"assets/skin/spinner-middle.png"},{id:"img_spinnertop",src:"assets/skin/spinner-top.png"},{id:"img_reversearrow",src:"assets/skin/reversearrow.png"}])};return a}();this.osujs=this.osujs||{};
osujs.Beat=function(){var a=function(){};a.prototype=new createjs.Container;a.prototype.containerInit=a.prototype.initialize;a.prototype.initialize=function(){this.containerInit()};a.prototype.fadeIn=function(b){this.alpha=0;createjs.Tween.get(this).to({alpha:1},b,createjs.Ease.linear)};a.prototype.fadeOut=function(b){createjs.Tween.get(this).to({alpha:0},b,createjs.Ease.quartOut).call(function(){osujs.beatmap.playArea.removeChild(this)}.bind(this))};a.prototype.begin=function(){createjs.Ticker.addEventListener("tick",
this);this.fadeIn(225);this.approachCircle.begin()};a.prototype.end=function(b){this.handleEvent=function(){};1==this.comboNum&&(osujs.beatmap.hitSplashType="g");if(100==b)osujs.beatmap.hitSplashType="k";else if(50==b||0===b)osujs.beatmap.hitSplashType="";createjs.Ticker.removeEventListener("tick",this);this.dispatchEvent({type:"score",score:b,combo:0===b?0:1,beat:this});b=osujs.beatmap.playArea.addChild(new osujs.HitSplash(b,this.comboEnd?osujs.beatmap.hitSplashType:""));b.x=this.hitSplashX;b.y=
this.hitSplashY;this.fadeOut(300)};a.prototype.HitCircle=function(){var b=function(b){this.initialize();this.scaleX=this.scaleY=osujs.beatmap.Difficulty.CircleSize;b=b.color;var a=osujs.assets.get("img_hitcircle"),c=osujs.assets.get("img_hitcircleoverlay"),e=this.addChild(new createjs.Bitmap(a)),h=this.addChild(new createjs.Bitmap(c));e.regX=a.width/2;e.regY=a.height/2;e.filters=[new createjs.ColorFilter(b[0]/255,b[1]/255,b[2]/255,1,0,0,0,0)];e.cache(0,0,a.width,a.height);h.regX=c.width/2;h.regY=
c.height/2};b.prototype=new createjs.Container;return b}();a.prototype.ApproachCircle=function(){var b=function(b){var a=osujs.assets.get("img_approachcircle");this.initialize();this.color=b.color;this.circleSize=b.circleSize;this.beginTime=b.beginTime;this.image=a;this.regX=a.width/2;this.regY=a.height/2;this.filters=[new createjs.ColorFilter(this.color[0]/255,this.color[1]/255,this.color[2]/255,1,0,0,0,0)];this.cache(0,0,a.width,a.height)};b.prototype=new createjs.Bitmap;b.prototype.begin=function(){this.timeInterval=
this.beginTime-osujs.beatmap.getTime();this.scaleX=this.scaleY=4*this.circleSize;createjs.Tween.get(this).to({scaleX:this.circleSize,scaleY:this.circleSize},this.timeInterval,createjs.Ease.Linear).call(function(){this.visible=0}.bind(this))};return b}();a.prototype.ComboText=function(){var b=function(b){this.initialize();b=b.comboNum.toString();for(var a=0,c=osujs.assets.get("img_default0").height,e=0;e<b.length;e++){var h=new createjs.Bitmap(osujs.assets.get("img_default"+b[e]));this.addChild(h);
h.x=a;a+=h.image.width+1}this.regX=a/2;this.regY=c/2;this.scaleX=this.scaleY=0.75};b.prototype=new createjs.Container;return b}();a.prototype.playHitSound=function(b){0===b?createjs.Sound.play("aud_"+osujs.beatmap.General.SampleSet+"-hitnormal"):(b&2&&createjs.Sound.play("aud_"+osujs.beatmap.General.SampleSet+"-hitwhistle"),b&4&&createjs.Sound.play("aud_"+osujs.beatmap.General.SampleSet+"-hitfinish"),b&8&&createjs.Sound.play("aud_"+osujs.beatmap.General.SampleSet+"-hitclap"))};return a}();
this.osujs=this.osujs||{};
osujs.Beatmap=function(){var a=function(b){this.initialize();this.osu=b.osu;this.music=b.music;osujs.beatmap=this;this.paused=this.ready=this.isOsuReady=this.isMusicReady=0;this.score=new osujs.Score(this);this.playArea=new createjs.Container;this.playArea.x=102;this.playArea.y=77;this.pauseScreen=new osujs.menu.Pause;this.pauseScreen.alpha=0};a.prototype=new createjs.Container;a.prototype.load=function(){this.loader=this.addChild(new osujs.Loader);var b=new createjs.LoadQueue;b.addEventListener("fileload",
function(b){this.osu=b.result;b=osujs.parseOsu(this.osu);for(var a in b)this[a]=b[a];this.isAssetsReady=1;console.log("osu loaded");this.isMusicReady&&(this.ready=1,this.dispatchEvent({type:"beatmapload"}),this.removeChild(this.loader))}.bind(this));createjs.Sound.addEventListener("fileload",function(b){b.src==this.music&&(this.music=createjs.Sound.createInstance(this.music),console.log("music loaded"),this.isMusicReady=1,this.isAssetsReady&&(this.ready=1,this.dispatchEvent({type:"beatmapload"}),
this.removeChild(this.loader)))}.bind(this));b.loadFile({id:"osu",src:this.osu,type:createjs.LoadQueue.TEXT});createjs.Sound.registerSound(this.music);console.log("Began loading")};a.prototype.play=function(){console.log("beatmap played");this.makeHitObjects();this.addEventListener("score",this.score);createjs.Ticker.addEventListener("tick",this);KEYS.addEventListener(this.handleEvent.bind(this));this.music.addEventListener("failed",this);this.music.addEventListener("succeeded",this);this.addChild(this.score);
this.addChild(this.playArea);this.music.play()};a.prototype.stop=function(){this.music.stop();this.removeAllChildren();createjs.Ticker.removeEventListener("tick",this);KEYS.removeEventListener(this.handleEvent.bind(this))};a.prototype.pause=function(){this.removeChild(this.playArea);this.addChild(this.pauseScreen);this.paused=1;createjs.Ticker.setPaused(!0);this.music.pause();createjs.Tween.get(this.pauseScreen).to({alpha:1},100,createjs.Ease.linear).ignoreGlobalPause=!0};a.prototype.resume=function(){this.paused=
0;this.addChild(this.playArea);createjs.Tween.get(this.pauseScreen).to({alpha:0},100,createjs.Ease.linear).call(function(){this.removeChild(this.pauseScreen);createjs.Ticker.setPaused(!1);this.music.resume()}.bind(this)).ignoreGlobalPause=!0};a.prototype.end=function(){this.stop();createjs.Sound.removeSound(this.music)};a.prototype.handleEvent=function(b){switch(b.type){case "tick":t=this.getTime();this.currHit<this.hitObjects.length&&t>this.hitObjects[this.currHit].approachTime&&(b=this.hitObjects[this.currHit++],
b.addEventListener("score",this),b.begin(),this.playArea.addChildAt(b,0));this.currHit>=this.hitObjects.length&&0===this.playArea.children.length&&(this.end(),setTimeout(function(){this.dispatchEvent({type:"end"})}.bind(this),500));break;case "score":this.score.handleEvent(b);this.currActive++;this.currActive<this.hitObjects.length&&this.hitObjects[this.currActive].activate();break;case "failed":this.addChild(new createjs.Text("Music playback failed.","36px Arial"));console.log("Music playback failed");
break;case "succeeded":this.startTime=createjs.Ticker.getTime();break;case "keydown":b.keyCode==KEYS.keyCode.ESC&&(this.paused?this.resume():this.pause())}};a.prototype.makeHitObjects=function(){var b={colorNum:0,comboNum:0,comboEnd:0};this.hitObjects=[];for(var a=this.currActive=this.currHit=0;a<this.HitObjects.length;a++){var f=this.HitObjects[a];b.circleSize=this.Difficulty.CircleSize;b.approachTime=f.type==osujs.Spinner?f.beginTime-100:f.beginTime-(2E3-150*this.Difficulty.ApproachRate);b.colorNum=
(b.colorNum+f.combo)%this.Color.length;b.color=this.Color[b.colorNum];b.comboNum=f.combo?1:++b.comboNum;b.comboEnd=!this.HitObjects[a+1]||this.HitObjects[a+1].combo?1:0;for(var c in b)f[c]=b[c];this.hitObjects.push(new f.type(f))}this.hitObjects[0].activate()};a.prototype.getTime=function(){return createjs.Ticker.getTime(!0)-this.startTime+osujs.settings.offset};return a}();this.osujs=this.osujs||{};
osujs.Cursor=function(){var a=function(){this.initialize()};a.prototype=new createjs.Container;a.prototype.containerInitialize=a.prototype.initialize;a.prototype.initialize=function(){this.containerInitialize();createjs.Ticker.addEventListener("tick",this);osujs.stage.addEventListener("stagemousedown",this);osujs.stage.addEventListener("stagemouseup",this);osujs.stage.canvas.style.cursor="none";var b=osujs.assets.get("img_cursor"),a=osujs.assets.get("img_cursormiddle");this.cursormiddle=this.addChild(new createjs.Bitmap(a));
this.cursormiddle.regX=a.width/2;this.cursormiddle.regY=a.height/2;this.cursor=this.addChild(new createjs.Bitmap(b));this.cursor.regX=b.width/2;this.cursor.regY=b.height/2};a.prototype.handleEvent=function(b){switch(b.type){case "tick":this.x=osujs.stage.mx;this.y=osujs.stage.my;this.cursor.rotation+=0.5;this.cursor.rotation%=360;osujs.stage.setChildIndex(this,osujs.stage.getNumChildren()-1);break;case "stagemousedown":createjs.Tween.get(this.cursor).to({scaleX:1.25,scaleY:1.25},35,createjs.Ease.linear).ignoreGlobalPause=
!0;break;case "stagemouseup":createjs.Tween.get(this.cursor).to({scaleX:1,scaleY:1},35,createjs.Ease.linear).ignoreGlobalPause=!0}};return a}();this.osujs=this.osujs||{};
osujs.HitCircle=function(){var a=function(b){for(var a in b)this[a]=b[a];this.initialize()};a.prototype=new osujs.Beat;a.prototype.beatInitialize=a.prototype.initialize;a.prototype.initialize=function(){this.beatInitialize();this.hitSplashX=this.x;this.hitSplashY=this.y;this.hitCircle=this.addChild(new this.HitCircle(this));this.comboText=this.addChild(new this.ComboText(this));this.approachCircle=this.addChild(new this.ApproachCircle(this))};a.prototype.beatEnd=a.prototype.end;a.prototype.end=function(b){this.hitCircle.removeEventListener("mousedown",
this);b&&this.playHitSound(this.hitSound);this.beatEnd(b)};a.prototype.handleEvent=function(b){switch(b.type){case "tick":260<osujs.beatmap.getTime()-this.beginTime&&this.end(0);break;case "mousedown":b=osujs.beatmap.getTime()-this.beginTime;var a=osujs.beatmap.Difficulty.OverallDifficulty;-260>b||(Math.abs(b)<=78-6*a?this.end(300):Math.abs(b)<=138-8*a?this.end(100):Math.abs(b)<=198-10*a?this.end(50):260>=Math.abs(b)&&this.end(0))}};a.prototype.activate=function(){this.hitCircle.addEventListener("mousedown",
this)};return a}();this.osujs=this.osujs||{};
osujs.HitSplash=function(){var a=function(b,a){this.score=b;this.type=a;this.initialize()};a.prototype=new createjs.Bitmap;a.prototype.bitmapInitialize=a.prototype.initialize;a.prototype.initialize=function(){this.bitmapInitialize();switch(this.score){case 300:this.image=osujs.assets.get("img_hit300"+this.type);break;case 100:this.image=osujs.assets.get("img_hit100"+this.type);break;case 50:this.image=osujs.assets.get("img_hit50"+this.type);break;case 0:this.image=osujs.assets.get("img_hit0"+this.type);
break;case "tick":this.image={width:0,height:0}}this.regX=this.image.width/2;this.regY=this.image.height/2;this.alpha=0;createjs.Tween.get(this).to({alpha:1},100,createjs.Ease.linear).wait(100).to({alpha:0},100,createjs.Ease.linear).call(function(){osujs.beatmap.playArea.removeChild(this)}.bind(this))};return a}();this.osujs=this.osujs||{};
osujs.initialize=function(){console.log(osujs.settings);createjs.Ticker.setFPS(60);createjs.Ticker.useRAF=1;osujs.internalResolution={width:1024,height:768};osujs.stage=new createjs.Stage(osujs.settings.canvasId);osujs.stage.canvas.width=osujs.settings.width;osujs.stage.canvas.height=osujs.settings.height;osujs.stage.scaleX=osujs.settings.width/osujs.settings.internalResolution.width;osujs.stage.scaleY=osujs.settings.height/osujs.settings.internalResolution.height;createjs.Ticker.addEventListener("tick",
osujs.stage);osujs.stage.addEventListener("stagemousedown",osujs.stage);osujs.stage.addEventListener("stagemouseup",osujs.stage);osujs.stage.handleEvent=function(a){switch(a.type){case "tick":this.mx=this.mouseX/this.scaleX;this.my=this.mouseY/this.scaleY;this.update();break;case "stagemousedown":this.mousedown=1;break;case "stagemouseup":this.mousedown=0}};osujs.stage.canvas.oncontextmenu=function(){event.preventDefault();return!1};KEYS.addEventListener(function(a){if((a.keyCode==osujs.settings.key_z||
a.keyCode==osujs.settings.key_x)&&osujs.stage.mouseInBounds)switch(a.type){case "keydown":a=new createjs.MouseEvent("stagemousedown",osujs.stage.mouseX,osujs.stage.mouseY);osujs.stage._handlePointerDown(-1,a);break;case "keyup":a=new createjs.MouseEvent("stagemouseup",osujs.stage.mouseX,osujs.stage.mouseY),osujs.stage._handlePointerUp(-1,a)}});fps=new createjs.Text("0","24px ABeeZee,Arial");fps.y=740;fps.x=986;createjs.Ticker.addEventListener("tick",fps);fps.handleEvent=function(){this.text=Math.round(createjs.Ticker.getMeasuredFPS())};
osujs.stage.addChild(new osujs.Loader).attachQueue(osujs.assets);osujs.assets.addEventListener("complete",function(){osujs.stage.removeAllChildren();osujs.cursor=osujs.stage.addChild(new osujs.Cursor);osujs.stage.addChild(fps);osujs.stage.addChild(new osujs.menu.Logo)});osujs.assets.beginLoad()};this.osujs=this.osujs||{};
osujs.Loader=function(){var a=function(){this.initialize();this.shape=this.addChild(new createjs.Shape);this.shape.graphics.setStrokeStyle(32).beginStroke("rgb(255, 200, 200)").arc(0,0,150,Math.PI/4,3*Math.PI/4,0).endStroke().beginStroke("rgb(255, 200, 200)").arc(0,0,150,-Math.PI/4,-3*Math.PI/4,1).endStroke();this.shape.cache(-182,-182,364,364);this.x=512;this.y=384;createjs.Ticker.addEventListener("tick",this)};a.prototype=new createjs.Container;a.prototype.handleEvent=function(b){switch(b.type){case "tick":this.shape.rotation+=
0.5;this.shape.rotation%=360;break;case "progress":this.text.text=Math.round(100*b.progress),this.text.regX=this.text.getMeasuredWidth()/2,this.text.regY=this.text.getMeasuredHeight()/2}};a.prototype.attachQueue=function(b){this.text=this.addChild(new createjs.Text("0","64px ABeeZee"));this.text.color="rgb(50,50,50)";this.text.regX=this.text.getMeasuredWidth()/2;this.text.regY=this.text.getMeasuredHeight()/2;b.addEventListener("progress",this)};return a}();this.osujs=this.osujs||{};osujs.menu={};
osujs.menu.Logo=function(){var a=function(){var b=osujs.assets.get("img_logo");this.initialize();this.image=b;this.regX=b.width/2;this.regY=b.height/2;this.x=osujs.internalResolution.width/2;this.y=osujs.internalResolution.height/2;this.addEventListener("mousedown",this)};a.prototype=new createjs.Bitmap;a.prototype.handleEvent=function(b){switch(b.type){case "mousedown":createjs.Sound.play("aud_Normal-hitnormal");if(!osujs.settings.beatmap)break;osujs.stage.removeChild(this);osujs.beatmap=osujs.stage.addChild(new osujs.Beatmap(osujs.settings.beatmap));
osujs.beatmap.addEventListener("beatmapload",function(){console.log("beatmap loaded");osujs.beatmap.play()});osujs.beatmap.addEventListener("end",function(){console.log("beatmap ended");osujs.stage.removeChild(osujs.beatmap);osujs.stage.addChild(this)}.bind(this));osujs.beatmap.load()}};return a}();
osujs.menu.Pause=function(){var a=function(){this.initialize();this.backdrop=this.addChild(new createjs.Shape);this.backdrop.graphics.f("rgb(255,255,255)").r(0,0,osujs.settings.internalResolution.width,osujs.settings.internalResolution.height);this.text=this.addChild(new createjs.Text("PAUSED","96px ABeeZee, Arial"));this.text.color="rgb(255,200,200)";this.text.regX=this.text.getMeasuredWidth()/2;this.text.regY=this.text.getMeasuredHeight()/2;this.text.x=osujs.settings.internalResolution.width/2;
this.text.y=osujs.settings.internalResolution.height/2};a.prototype=new createjs.Container;return a}();this.osujs=this.osujs||{};
osujs.parseOsu=function(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=a[b].trim();a=function(b){for(var a={version:[]},c="version",e=0;e<b.length;e++)/\[(\w*)\]/.exec(b[e])?a[c=/\[(\w*)\]/.exec(b[e])[1]]=[]:b[e]&&a[c].push(b[e]);return a}(a);b=Object.create(null);b.Version=parseInt(/osu file format v(\d+)/.exec(a.version[0])[1],10);b.General=function(b){for(var a={},c=0;c<b.length;c++){var e=b[c].split(":");a[e[0]]=e[1].slice(1)}return a}(a.General);b.Color=function(b){var a=[];a.SliderBorder=
[255,255,255];if(b)for(var c=0;c<b.length;c++){var e=b[c].split(":");"SliderBorder"!=e[0]?(e=e[1].trim().split(","),a.push([parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])):(e=e[1].trim().split(","),a.SliderBorder=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else a.push([255,0,0]),a.push([255,255,0]),a.push([0,255,0]),a.push([0,0,255]);return a}(a.Colours);b.Difficulty=function(b){for(var a={},c=0;c<b.length;c++){var e=b[c].split(":");a[e[0]]=parseFloat(e[1])}a.CircleSize=1-0.1*
(a.CircleSize-3);a.ApproachRate=a.ApproachRate||2;return a}(a.Difficulty);b.HitObjects=function(b){for(var a=[],c=0;c<b.length;c++){var e,h=b[c].split(","),g=Object.create(null);g.x=1.6*parseInt(h[0],10);g.y=1.6*parseInt(h[1],10);g.beginTime=parseInt(h[2],10);g.combo=parseInt(h[3],10)>>2;g.hitSound=parseInt(h[4],10);if(7==h.length)g.type=osujs.Spinner,g.endTime=parseInt(h[5],10);else if(6<h.length){g.type=osujs.Slider;var l=h[5].split("|"),k=[{x:0,y:0}],m=[];g.sliderType=l[0];for(e=1;e<l.length;e++){var n=
l[e].split(":"),p=1.6*parseInt(n[0],10)-g.x,n=1.6*parseInt(n[1],10)-g.y;if(p==k[k.length-1].x&&n==k[k.length-1].y){switch(g.sliderType){case "P":m.push(new curvejs.CircleCurve(k));break;case "L":m.push(new curvejs.LinearCurve(k));break;case "B":m.push(new curvejs.BezierCurve(k))}k=[]}k.push({x:p,y:n})}switch(g.sliderType){case "P":m.push(new curvejs.CircleCurve(k));break;case "L":m.push(new curvejs.LinearCurve(k));break;case "B":m.push(new curvejs.BezierCurve(k))}g.curve=m.splice(0,1)[0];g.curve.compose(m);
g.length=1.6*parseInt(h[7],10);g.repeats=parseInt(h[6],10);g.curve.length<g.length?g.curve.addPoint(g.curve.pointAtLength(g.length)):g.curve.length>g.length&&g.curve.clipAtLength(g.length);if(h[8])for(h=h[8].split("|"),g.hitSounds=[],e=0;e<h.length;e++)g.hitSounds.push(parseInt(h[e],10))}else g.type=osujs.HitCircle;a.push(g)}return a}(a.HitObjects);b.TimingPoints=function(b){for(var a=[],c,e,h=0;h<b.length;h++)c=b[h].split(","),e=parseInt(c[0],10),c=parseFloat(c[1]),0>c&&(c=a[a.length-1].beatLength),
a.push({t:e,beatLength:c});a.getBeatLength=function(a){for(var b=this[0].beatLength,d=0;d<this.length;d++){if(a<this[d].t)return b;b=this[d].beatLength}};return a}(a.TimingPoints);console.log(b);return b};this.osujs=this.osujs||{};
osujs.Score=function(){var a=function(b){this.beatmap=b;this.initialize()};a.prototype=new createjs.Container;a.prototype.containerInitialize=a.prototype.initialize;a.prototype.initialize=function(){this.containerInitialize();this.dispScore=this.score=this.combo=0;this.beatmap.addEventListener("score",this);createjs.Ticker.addEventListener("tick",this);this.scoreText=this.addChild(new this.ScoreText(this));this.comboText=this.addChild(new this.ComboText(this));this.comboText.update()};a.prototype.handleEvent=
function(b){switch(b.type){case "tick":this.dispScore!=this.score&&(this.dispScore+=Math.ceil((this.score-this.dispScore)/4),this.scoreText.update());break;case "score":this.score+=b.score+b.score*this.combo/25,this.combo=b.combo?this.combo+1:0,this.comboText.update()}};a.prototype.ScoreText=function(){var b=function(b){var a=osujs.assets.get("img_score0");this.par=b;this.initialize();this.digits=[];for(b=0;8>b;b++){var c=this.addChild(new createjs.Bitmap(a));c.regX=a.width/2;c.x=b*a.width;this.digits.push(c)}this.x=
1024-7.5*a.width-8;this.y=8};b.prototype=new createjs.Container;b.prototype.update=function(){s=this.par.dispScore.toString();for(var b=0;b<s.length;b++){var a=this.digits[8-s.length+b],c=osujs.assets.get("img_score"+s[b]);a.image=c;a.regX=c.width/2}};return b}();a.prototype.ComboText=function(){var b=function(b){this.par=b;this.x=8;this.y=768-osujs.assets.get("img_score0").height-8};b.prototype=new createjs.Container;b.prototype.update=function(){var b=this.par.combo.toString();this.removeAllChildren();
for(var a=osujs.assets.get("img_scorex"),c=this.addChild(new createjs.Bitmap(a)),a=a.width,e=0;e<b.length;e++)c=new createjs.Bitmap(osujs.assets.get("img_score"+b[e])),this.addChild(c),c.x=a,a+=c.image.width+1};return b}();return a}();this.osujs=this.osujs||{};
osujs.settings=function(){var a={canvasId:"osujs_canvas",internalResolution:{width:1024,height:768}};a.width=parseInt(localStorage.getItem("settings.width"),10)||640;a.height=parseInt(localStorage.getItem("settings.height"),10)||480;a.offset=parseInt(localStorage.getItem("settings.offset"),10)||0;a.key_z=parseInt(localStorage.getItem("settings.key_z"),10)||90;a.key_x=parseInt(localStorage.getItem("settings.key_x"),10)||88;a.set=function(b,a){switch(b){case "width":this.width=a;osujs.stage.canvas.width=
a;osujs.stage.scaleX=a/osujs.settings.internalResolution.width;break;case "height":this.height=a;osujs.stage.canvas.height=a;osujs.stage.scaleY=a/osujs.settings.internalResolution.height;break;default:this[b]=a}localStorage.setItem("settings."+b,a)};return a}();this.osujs=this.osujs||{};
osujs.Slider=function(){var a=function(a){for(var d in a)this[d]=a[d];this.initialize()};a.prototype=new osujs.Beat;a.prototype.beatInitialize=a.prototype.initialize;a.prototype.initialize=function(a){this.beatInitialize();this.beatLength=osujs.beatmap.TimingPoints.getBeatLength(this.beginTime);this.speed=160*osujs.beatmap.Difficulty.SliderMultiplier/this.beatLength;this.totalTime=this.length/this.speed;this.initialHit=this.ticksHit=this.repeated=0;this.createBody();this.tail=this.addChild(new this.HitCircle(this));
this.tail.x=this.curve.points[this.curve.points.length-1].x;this.tail.y=this.curve.points[this.curve.points.length-1].y;this.head=this.addChild(new this.HitCircle(this));this.headArrow=this.addChild(new this.ReverseArrow(this,0));this.tailArrow=this.addChild(new this.ReverseArrow(this,1));1<this.repeats&&(this.tailArrow.visible=1);this.createTicks();this.comboText=this.addChild(new this.ComboText(this));this.ball=this.addChild(new this.Ball(this));this.approachCircle=this.addChild(new this.ApproachCircle(this));
this.hitSplashX=this.x+(this.repeats%2?this.tail.x:this.head.x);this.hitSplashY=this.y+(this.repeats%2?this.tail.y:this.head.y)};a.prototype.handleEvent=function(a){switch(a.type){case "tick":a=osujs.beatmap.getTime()-this.beginTime;if(0>a)break;!this.initialHit&&a>138-8*osujs.beatmap.Difficulty.OverallDifficulty&&(osujs.beatmap.dispatchEvent({type:"score",score:0,combo:0,beat:this}),this.initialHit=1);0===this.repeated&&this.start();a>=this.totalTime?this.repeats!==this.repeated?this.repeat():this.end(300):
this.update(a);break;case "mousedown":a=osujs.beatmap.getTime()-this.beginTime;if(-260>a)break;Math.abs(a)<=138-8*osujs.beatmap.Difficulty.OverallDifficulty?(this.ticksHit+=1,this.playHitSound(this.hitSound),osujs.beatmap.dispatchEvent({type:"score",score:0,combo:1,beat:this})):osujs.beatmap.dispatchEvent({type:"score",score:0,combo:0,beat:this});this.initialHit=1;this.comboText.visible=0;this.head.removeEventListener("mousedown",this)}};a.prototype.start=function(){this.comboText.visible=0;this.ball.visible=
1;for(var a=0;a<this.ticks.length;a++)this.ticks[a].visible=1;this.repeated=1};a.prototype.update=function(a){this.ball.update((this.repeated%2?a:this.totalTime-a)*this.speed);for(var d=0;d<this.ticks.length;d++)a>this.ticks[d].t&&this.ticks[d].visible&&(this.ball.clicked?(this.ticksHit+=1,osujs.beatmap.dispatchEvent({type:"score",score:0,combo:1,beat:this})):(this.ball.sliderfollowcircle.visible=0,osujs.beatmap.dispatchEvent({type:"score",score:0,combo:0,beat:this})),this.ticks[d].visible=0)};a.prototype.repeat=
function(){this.beginTime+=this.totalTime;for(var a=0;a<this.ticks.length;a++)this.ticks[a].visible=1,this.ticks[a].t=this.totalTime-this.ticks[a].t;a=this.hitSounds?this.hitSounds.splice(0,1)[0]:this.hitSound;this.ball.clicked&&(this.playHitSound(a),this.ticksHit+=1);2<=this.repeats-this.repeated?this.headArrow.visible=this.tailArrow.visible=1:this.repeated%2?this.tailArrow.visible=0:this.headArrow.visible=0;this.repeated+=1};a.prototype.end=function(){a.prototype.beatEnd=a.prototype.end;return function(){this.removeChild(this.ball);
var a=1+this.repeats*(this.ticks.length+1),d=this.hitSounds?this.hitSounds.splice(0,1)[0]:this.hitSound;this.ball.clicked&&(this.playHitSound(d),this.ticksHit+=1);this.ticksHit==a?this.beatEnd(300):this.ticksHit>=a/2?this.beatEnd(100):this.ticksHit?this.beatEnd(50):this.beatEnd(0)}}();a.prototype.createBody=function(){function a(b,e){d.graphics.mt(c[0].x,c[0].y).ss(b*f,0,1).s(e);for(var l=0;l<c.length;l++)d.graphics.lt(c[l].x,c[l].y)}var d=new createjs.Shape,f=osujs.beatmap.Difficulty.CircleSize*
osujs.assets.get("img_hitcircle").width,c=this.curve.points,e=osujs.beatmap.Color.SliderBorder;a(0.9,"rgb(150, 150, 150)");a(0.88,"rgb("+e[0]+","+e[1]+","+e[2]+")");a(0.77,"rgb(150, 150, 150)");a(0.75,"rgb("+this.color[0]+","+this.color[1]+","+this.color[2]+")");e=this.curve.boundingBox();d.cache(e.left-f/2,e.up-f/2,e.right-e.left+f,e.down-e.up+f);this.body=this.addChild(d)};a.prototype.createTicks=function(){var a=this.beatLength*this.speed/osujs.beatmap.Difficulty.SliderTickRate,d=function(a,b){this.initialize();
var d=osujs.assets.get("img_sliderscorepoint"),f=a.curve.pointAtLength(b*a.speed);this.image=d;this.regX=d.width/2;this.regY=d.height/2;this.x=f.x;this.y=f.y;this.t=b;this.visible=0};d.prototype=new createjs.Bitmap;this.ticks=[];for(var f=1;f*a<this.length-64;f++)this.ticks.push(this.addChild(new d(this,f*a/this.speed)))};a.prototype.ReverseArrow=function(){var a=function(a,b){this.slider=a;this.initialize(b)};a.prototype=new createjs.Bitmap;a.prototype.bitmapInitialize=a.prototype.initialize;a.prototype.initialize=
function(a){var b=osujs.assets.get("img_reversearrow");this.image=b;this.regX=b.width/2;this.regY=b.height/2;this.x=a?this.slider.tail.x:this.slider.head.x;this.y=a?this.slider.tail.y:this.slider.head.y;this.rotation=this.slider.curve.angleAtLength(a?this.slider.length:0)+(a?180:0);this.visible=0;510<=this.slider.color[0]+this.slider.color[1]+this.slider.color[2]&&(this.filters=[new createjs.ColorFilter(0.1,0.1,0.1,1,0,0,0,0)],this.cache(0,0,2*b.width,2*b.height))};return a}();a.prototype.Ball=function(){var a=
function(a){this.slider=a;this.initialize()};a.prototype=new createjs.Container;a.prototype.containerInitialize=a.prototype.initialize;a.prototype.initialize=function(){this.containerInitialize();var a=osujs.assets.get("img_sliderb0"),b=osujs.assets.get("img_sliderfollowcircle");this.reverse=0<=this.slider.curve.tangentAtLength(0).x?0:1;this.sliderb=this.addChild(new createjs.BitmapAnimation(osujs.assets.sliderb));this.sliderb.regX=a.width/2;this.sliderb.regY=a.height/2;this.reverse?this.sliderb.gotoAndPlay("reverseSlide"):
this.sliderb.gotoAndPlay("slide");this.sliderfollowcircle=this.addChild(new createjs.Bitmap(b));this.sliderfollowcircle.regX=b.width/2;this.sliderfollowcircle.regY=b.height/2;this.sliderfollowcircle.visible=0;this.radius=b.width/2;this.scaleX=this.scaleY=osujs.beatmap.Difficulty.CircleSize;this.visible=this.clicked=0};a.prototype.update=function(a){var b=this.slider.curve.pointAtLength(a);this.x=b.x;this.y=b.y;this.sliderb.rotation=this.slider.curve.angleAtLength(a)+(this.reverse?180:0);a=this.x+
this.slider.x+osujs.beatmap.playArea.x-osujs.stage.mx;b=this.y+this.slider.y+osujs.beatmap.playArea.y-osujs.stage.my;osujs.stage.mousedown&&Math.sqrt(Math.pow(a,2)+Math.pow(b,2))<=this.radius?this.clicked=this.sliderfollowcircle.visible=1:this.clicked=0};return a}();a.prototype.activate=function(){this.head.addEventListener("mousedown",this)};return a}();this.osujs=this.osujs||{};
osujs.Spinner=function(){var a=function(a){for(var d in a)this[d]=a[d];this.initialize()};a.prototype=new osujs.Beat;a.prototype.beatInitialize=a.prototype.initialize;a.prototype.initialize=function(){this.beatInitialize();this.hitSplashX=this.x;this.hitSplashY=this.y;this.length=this.endTime-this.beginTime;var a=osujs.assets.get("img_spinnertop"),d=osujs.assets.get("img_spinnermiddle"),f=osujs.assets.get("img_spinnerbottom"),c=osujs.assets.get("img_spinnerclear");this.spinnerbg=this.addChild(new createjs.Shape);
this.spinnerbottom=this.addChild(new createjs.Bitmap(f));this.spinnermiddle=this.addChild(new createjs.Bitmap(d));this.spinnertop=this.addChild(new createjs.Bitmap(a));this.spinnerclear=this.addChild(new createjs.Bitmap(c));this.spinnerbg.graphics.f("rgb(0,0,0)").r(0,0,1024,768);this.spinnerbg.regX=512;this.spinnerbg.regY=384;this.spinnertop.regX=a.width/2;this.spinnertop.regY=a.height/2;this.spinnermiddle.regX=d.width/2;this.spinnermiddle.regY=d.height/2;this.spinnerbottom.regX=f.width/2;this.spinnerbottom.regY=
f.height/2;this.spinnerclear.regX=c.width/2;this.spinnerclear.regY=c.height/2;this.speed=this.angle=this.cumAngle=this.prevAngle=this.prevY=this.prevX=this.prevTime=this.spinnerclear.visible=0;this.maxSpeed=50;this.speedScale=0.05;this.friction=0.7};a.prototype.begin=function(){this.fadeIn(100)};a.prototype.activate=function(){createjs.Ticker.addEventListener("tick",this)};a.prototype.handleEvent=function(a){switch(a.type){case "tick":var d=osujs.stage.mx-this.x,f=osujs.stage.my-this.y,c=0,c=0===
d?0<f?90:270:360*Math.atan(f/d)/(2*Math.PI)+(0<d?0:180);this.angle=0<c?c%360:0===c?c:c%360+360;osujs.stage.mousedown&&(d=this.angle-this.prevAngle,-180>d&&(d+=360),180<d&&(d+=-360),this.speed+=d/4,Math.abs(this.speed)==this.maxSpeed&&console.log("TAICHOU, GENKAI DA!!!"));this.speed*=this.friction;this.prevAngle=this.angle;this.spinnertop.rotation+=this.speed*a.delta*this.speedScale;this.cumAngle+=Math.abs(this.speed*a.delta*this.speedScale);this.cumAngle/360>this.length/600&&(this.spinnerclear.visible=
1);osujs.beatmap.getTime()>this.endTime&&(a=this.cumAngle/360,a>this.length/600?this.end(300):a>this.length/800?this.end(100):a>this.length/1200?this.end(50):this.end(0))}};return a}();this.site=this.site||{};
site.beatmaps=function(){var a={active:null,handleClick:function(b){b=$(b);a.active&&a.active.removeClass("active");b.addClass("active");$("#currentbeatmap").html(b.attr("songTitle")+" ("+b.attr("difficulty")+") &mdash; "+b.attr("artist"));a.active=b;osujs.settings.beatmap={osu:"assets/beatmaps/"+b.attr("osu"),music:"assets/beatmaps/"+b.attr("music")}}};return a}();
this.KEYS=function(){var a=[],b;a.keyCode={ESC:27};for(b=0;256>b;b++)a[b]=0;a.callbacks=[];document.addEventListener("keydown",function(d){d=d||window.event;if(!(d.keyCode>=a.length||0>d.keyCode)&&0===a[d.keyCode])for(a[d.keyCode]=1,b=0;b<a.callbacks.length;b++)a.callbacks[b]({type:"keydown",keyCode:d.keyCode})});document.addEventListener("keyup",function(d){d=d||window.event;if(!(d.keyCode>=a.length||0>d.keyCode)&&1===a[d.keyCode])for(b=a[d.keyCode]=0;b<a.callbacks.length;b++)a.callbacks[b]({type:"keyup",
keyCode:d.keyCode})});a.addEventListener=function(b){a.callbacks.push(b)};a.removeEventListener=function(b){for(var f=0;f<a.callbacks.length;f++)if(a.callbacks[f]===b){a.callbacks.splice(f,1);break}};return a}();$("#options_width").attr("value",osujs.settings.width);$("#options_height").attr("value",osujs.settings.height);$("#options_offset").attr("value",osujs.settings.offset);$("#options_key_x").attr("value",String.fromCharCode(osujs.settings.key_x));$("#options_key_z").attr("value",String.fromCharCode(osujs.settings.key_z));
$("#options_width").bind("input",function(a){osujs.settings.set("width",parseInt($(this).val(),10))});$("#options_height").bind("input",function(a){osujs.settings.set("height",parseInt($(this).val(),10))});$("#options_offset").bind("input",function(a){osujs.settings.set("offset",parseInt($(this).val(),10))});$("#options_key_x").bind("keydown",function(a){this.value=String.fromCharCode(a.keyCode);osujs.settings.set("key_x",a.keyCode)});
$("#options_key_z").bind("keydown",function(a){this.value=String.fromCharCode(a.keyCode);osujs.settings.set("key_z",a.keyCode)});